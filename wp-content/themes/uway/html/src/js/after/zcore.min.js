/* global WOW, Modernizr */
(function ($) {

    // ABOUT VERSION JQUERY
    console.log("VENCREATIVE : " + jQuery.fn.jquery);

    // INIT WOW
    var wow = new WOW(
        {
            boxClass: 'wow',      // animated element css class (default is wow)
            animateClass: 'animated', // animation css class (default is animated)
            offset: 0,          // distance to the element when triggering the animation (default is 0)
            mobile: true,       // trigger animations on mobile devices (default is true)
            live: true,       // act on asynchronously loaded content (default is true)
            callback: function (box) {
                // the callback is fired every time an animation is started
                // the argument that is passed in is the DOM node being animated
            },
            scrollContainer: null // optional scroll container selector, otherwise use window
        }
    );
    wow.init();

    // INIT LAZYLOAD
    $(".lazyload").lazyload({effect: "fadeIn", effectspeed: 1000});
    $(".lazygo").lazyload({effect: "fadeIn", effectspeed: 1000, event: 'load'});

    // CHECK IE
    $.msieversion = function () {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
        return (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./));
    };

    // FIX OBJECT FIT
    $.fixObjectFit = function () {
        if (!Modernizr.testProp('objectFit')) {
            $('.img-drop').each(function () {
                var $this = $(this),
                    $img = $(this).find("img:first-child"),
                    src = $img.prop("src"),
                    data_src = $img.data("src");
                if (src || data_src) {
                    $this.css("background-image", 'url(' + ((data_src && data_src.length > 0) ? data_src : src) + ')');
                    $img.css({opacity: 0, visibility: 'hidden'});
                }
            });
        }
    };
    $.fixObjectFit();

    // TABS ANIMATION EXPAND
    if ($(".tabs-anim").length > 0) {
        $(".tabs-anim-ul a").on("click", function (e) {
            var tabid = $(this).attr("href"),
                $tabpane = $(tabid),
                $tabcontent = $tabpane.parent();
            setTimeout(function () {
                $tabcontent.height($tabpane.outerHeight(true));
            }, 250);
        });

        var setHeightTabContent = function () {
            $(".tab-content.tabs-anim").each(function () {
                $(this).height($(this).outerHeight(true));
            });
        };
        var resizeTimer;
        $(window).on('resize', function (e) {
            clearTimeout(resizeTimer);
            $(".tab-content.tabs-anim").height("");
            resizeTimer = setTimeout(setHeightTabContent, 250);
        });
        setHeightTabContent();
    }

    $.getWithScrollbarWindow = function () {
        var scrollDiv = $("<div style='width: 100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;'></div>");
        $("body").append(scrollDiv);
        var scrollbarWidth = scrollDiv[0].offsetWidth - scrollDiv[0].clientWidth;
        scrollDiv.remove();
        return scrollbarWidth;
    };

    // BACKDROP
    $.backdrop_show = function (options) {
        var settings = $.extend({
            callbackshow: null, callbackhide: null,
            notscroll: true, timeout: 500, class: ''
        }, options);
        var getWithScrollbarWindow = $.getWithScrollbarWindow();

        if ($(".backdrop-core").length < 1) {
            $("body").append("<div class='backdrop-core " + settings.class + "'></div>");
            setTimeout(function () {
                $(".backdrop-core").addClass("opening");
                if (getWithScrollbarWindow > 0) { $("body").css({marginRight: getWithScrollbarWindow}); }
                if (settings.callbackshow) {
                    settings.callbackshow();
                }
                if (settings.notscroll) {
                    $("body").addClass("modal-open");
                }
            }, 10);
            $(".backdrop-core").on("click", function () {
                $.backdrop_hide(settings);
            });

        }
    };
    $.backdrop_hide = function (options) {
        var settings = $.extend({
            callbackhide: null,
            notscroll: true, timeout: 500, class: ''
        }, options);

        if ($(".backdrop-core").length > 0) {
            if (settings.callbackhide) {
                settings.callbackhide();
            }
            $(".backdrop-core").removeClass("opening");
            if (settings.notscroll) {
                $("body").removeClass("modal-open").css({marginRight: ""});
            }
            setTimeout(function () {
                $(".backdrop-core").remove();
            }, settings.timeout);
        }
    };


    // SHOW LOADING
    $.fn.ven_loading_show = function (options) {
        var settings = $.extend({
            time: 0,
            classloading: '.ven-loading',
            class: '',
            fixed: false,
            zindex: 11
        }, options);
        var _this = this.selector ? $(this) : $("body");
        var _loading = $("<div class='" + settings.classloading.substring(1) + " " + settings.class + "'><div class='img'><i class='icon spinner'></i></div></div>");
        if (settings.zindex !== 1) { _loading.css({zIndex: settings.zindex}); }
        if (settings.fixed) { _loading.css({position: "fixed"}); }
        if (_this.find(settings.classloading).length < 1) {
            _this.append(_loading);
            setTimeout(function () {
                _loading.addClass("opening");
            }, 10);
            if (settings.time !== 0) {
                setTimeout(function () {
                    _loading.removeClass("opening");
                }, settings.time);
                setTimeout(function () {
                    _loading.remove();
                }, settings.time + 400);
            }
        }
    };
    $.fn.ven_loading_hide = function (options) {
        var settings = $.extend({
            classloading: '.ven-loading'
        }, options);
        var _this = this.selector ? $(this) : $("body");
        var _loading = _this.find(settings.classloading);
        if (_loading.length >= 1) {
            _loading.removeClass("opening");
            setTimeout(function () {
                _loading.remove();
            }, 400);
        }
    };


    // SHOW NOTI
    $.ven_noti = function (html, time) {
        if (!time) { time = 2500; }
        // console.log(time);
        if ($(".ven-noti").length < 1) {
            $("body").append("<div class='ven-noti'>" + html + "</div>");
            setTimeout(function () {
                $(".ven-noti").addClass("opening");
            }, 10);
            setTimeout(function () {
                $(".ven-noti").removeClass("opening");
            }, time);
            setTimeout(function () {
                $(".ven-noti").remove();
            }, time + 400);
        }
    };



})(jQuery);